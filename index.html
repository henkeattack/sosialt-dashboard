<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
</head>
<body class="dark"> 
    <!-- Facebook login knapp med velkomsthilsen-->
    <div class="login-button">
      <fb:login-button scopes="email,public_profile,pages_show_list, pages_read_engagement,pages_manage_engagement,pages_read_user_content,read_insights,instagram_manage_insights,instagram_basic,ads_read" data-size="large" data-button-type="login_with" data-layout="rounded" onlogin="handlefbLogin();">Logg på med Facebook</fb:login-button>
      <div class="status" id="status"></div></div>
<div class="wrapper">
  <div class="container1">
    <header>
      <section>
        <!-- Logo YX-->
        <div class="logo1"><span><img src="images/yx_logo_1.png" class="img-thumbnail" alt=""/></div> 
        <!-- Logo 7-eleven -->
        <div class="logo2"><img src="images/logo_7eleven.png" class="img-thumbnail" alt="" /></div>     
    </section>
    <section> 
      <!-- Header tittel-->
      <div class="header-headline">
        <div class="header-headline-1">Sosiale Medier Dashboard</div>
        <div class="header-headline-2" id="totalFollowers"></div>
      </div>
      <!-- Dark/light mode toggle-->
      <div class="header-toggler">
        <div style="font-weight: 700;">Visning</div>
      <div class="toggler" id="toggler">
        <div id="toggler-circle" class="toggler-circle"></div>
        </div>
      </div>  
    </section>
        <!-- Sosiale Medier Cards Section -->
      <section>
        <div class="col-md-3 col-sm-6 padding-left resp-padding">
          <div class="header-card facebook">
            <div class="header-card-1">
              <span> <img src="images/icon-facebook.svg" alt="" /> </span>
              <span class="header-card-1-name">@YX7ElevenGjovikSyd</span>
            </div>
            <div class="header-card-2" id="followers"></div>
            <div class="header-card-3">Følgere</div>
            <div class="header-card-4" id="colorChange">
              <span> <img id="myImg" alt=""></span>
              <span id="newFaceFollowers"></span>
            </div>
          </div>
        </div>
      
        <div class="col-md-3 col-sm-6 padding-left resp-padding">
          <div class="header-card instagram">
            <div class="header-card-1">
              <span> <img src="images/icon-instagram.svg" alt="" /> </span>
              <span class="header-card-1-name">@yx711gjoviksyd</span>  
            </div>
            <div class="header-card-2" id="instaFollowers"></div>
            <div class="header-card-3">Følgere</div>
            <div class="header-card-4" id="instaColor">
              <span><img id="myImg2" alt=""></span>
              <span id=oldInstaFollowers> </span>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main>
      <div class="col-md-12 padding-left">
        <div class="main-heading">Ukas Trafikk</div>
        </div>

        <div class="row main-row-margin">
          
          <div class="col-md-4">
            <div class="main-card">
              <div class="main-card-top">
                <span>Sidevisninger</span>
                <span><img src="images/icon-facebook.svg" alt=""></span>
                </div>
                <div class="main-card-bottom">
                  <span id="pageStats"></span> </div>
                  <div class="main-card-bottom1">
                  <span class="comparison" id="changeInfo"></span>
                  <span id="changeColor"> 
                  <span><img id="myImg3" alt=""></span> 
                  <span id="pageStatsWeek"></span></span>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="main-card">
              <div class="main-card-top">
                <span>Likerklikk</span>
                <span><img src="images/icon-facebook.svg" alt=""></span>
                </div>
                <div class="main-card-bottom">
                  <span id="pageLikes"></span> </div>
                  <div class="main-card-bottom1">
                  <span class="comparison" id="changeInfo2"></span>                  
                  <span id="changeColor2">
                  <span><img id="myImg4" alt=""></span> 
                  <span id="weeklyPageLikes"></span></span>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="main-card">
              <div class="main-card-top">
                <span>Rekkevidde</span>
                <span><img src="images/icon-facebook.svg" alt=""></span>
                </div>
                <div class="main-card-bottom">
                  <span id="fbReach"></span> </div>
                  <div class="main-card-bottom1">
                  <span class="comparison" id="changeInfo6"></span>                  
                  <span id="changeColor6">
                  <span><img id="myImg8" alt=""></span> 
                  <span id="weeklyFbReach"></span></span>
              </div>
            </div>
          </div>  
      </div>

        <div class="row">

          <div class="col-md-4">
            <div class="main-card">
              <div class="main-card-top">
                <span>Engasjement</span>
                <span><img src="images/icon-facebook.svg" alt=""></span>
                </div>
                <div class="main-card-bottom">
                  <span id="pageEngagement"></span> </div>
                  <div class="main-card-bottom1">
                  <span class="comparison" id="changeInfo5"></span>                  
                  <span id="changeColor5">
                  <span><img id="myImg7" alt=""></span> 
                  <span id="weeklyPageEngagement"></span></span>
              </div>
            </div>
          </div>   
          
          <div class="col-md-4">
            <div class="main-card">
              <div class="main-card-top">
                <span>Profilvisninger</span>
                <span><img src="images/icon-instagram.svg" alt=""></span>
                </div>
                <div class="main-card-bottom">
                  <span id="instaPageReach"></span> </div>
                  <div class="main-card-bottom1">
                  <span class="comparison" id="changeInfo3"></span>
                  <span id="changeColor3">
                  <span><img id="myImg5" alt=""></span> 
                  <span id="instaPageViewsWeek"></span></span>
                </div>
            </div>
          </div>

        <div class="col-md-4">
          <div class="main-card">
            <div class="main-card-top">
              <span>Rekkevidde</span>
              <span><img src="images/icon-instagram.svg" alt=""></span>
              </div>
              <div class="main-card-bottom">
                <span id="instaPageViews"></span> </div>
                <div class="main-card-bottom1">
                <span class="comparison" id="changeInfo4"></span>
                <span id="changeColor4">
                <span><img id="myImg6" alt=""></span>
                <span id="instaPageReachWeek"></span></span>
              </div>
          </div>
        </div>  
        </div>
        <div class="definitions-header">Dette ser jeg på her</div>  
        <div class="definitions">
          <ul class="liste">
            <li><strong>Følgere: </strong>Hvor mange følgere en Instagram-side har og hvor mange som har likt Facebook-siden til bedriften.</li>
            <li><strong>Visninger: </strong>Antall ganger noen har klikket seg inn på Facebook-siden. Visninger teller hvor mange ganger siden har blitt vist av andre brukere.</li>
            <li><strong>Rekkevidde: </strong>Antall ganger innhold fra siden din dukker opp på en brukers skjerm. Dette inkluderer innlegg, stories, annonser og annen informasjon fra siden.</li>
            <li><strong>Engasjement: </strong>Antall brukere som har foretatt handlinger på siden. Dette inkluderer alle typer aktiviter. </li>
            <li><strong>Likerklikk: </strong>Antallet ganger noen har trykket liker på innhold fra siden. </li>
            <li><strong>Sammenligningsdata: </strong>Alt av sammenligningsdata markert i grønt eller rødt sammenligner disse tallene med forrige ukes innsikt. Grønn farge og pil opp betyr økning, rødt og pil ned betyr nedgang og grått betyr ingen endring.</li>
          </ul>
        </div>
      </main>
    </div>
  </div>

<script type="module">
    // implementerer data fra js ----->
    import {
      initializeFlow,
      doLogin,
      getAppToken,
      getMyfbAccInfo,
      getMyfbAccPage,
      getMyfbPageInsights,
      getMyFbInstaBusinessAcc,
      getMyInstagramAccInfo,
      getMyInstagramAccInsight,
      getInstaFollowers
    } from "./js/script.js";

    const appId = "4223696350981884";
    const clientToken = "7ea19420eda210c55d3c38515aef5cd6";
    const loginSuccessFunc = async (responseItem) => {
    const appToken = await getAppToken(
          responseItem.userIdInfo,
          responseItem.accessTokenInfo
        );

        // 2. hent Facebook-konto
        const fbInfo = await getMyfbAccInfo(
          responseItem.userIdInfo,
          responseItem.accessTokenInfo
        );
        // Returner velkomsthilsen
        document.getElementById("status").innerHTML = "Suksessfull login. Velkommen til siden, " + fbInfo.name;

        // Sammenligningsdata - litt annerledes for følgere
        const styleHeader = document.getElementById("colorChange");
        function changeHeader(newNumber) {
          if (newNumber > 0 ) {
            styleHeader.style.color = "hsl(163, 72%, 41%)";
            document.getElementById("myImg").src = "images/icon-up.svg";
          } else {
            styleHeader.style.color = "hsl(228, 34%, 66%)";
          }
        }

        // Bytt farge og ikon på forrige ukes sammenligningsdata
        const styleCard = document.getElementById("changeColor");
        function changeColor(oldNumber, newNumber) {
          if (oldNumber > newNumber) {
            styleCard.style.color = "hsl(356, 69%, 56%)";
            document.getElementById("myImg3").src = "images/icon-down.svg";
          } else if (oldNumber == newNumber) {
            styleCard.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard.style.color = "hsl(163, 72%, 41%)";
            document.getElementById("myImg3").src = "images/icon-up.svg";
          };
        }

        // Legger inn beskrivelse av målte periode
        document.getElementById("changeInfo").innerHTML = "Endring siste 7 dager:";
        document.getElementById("changeInfo2").innerHTML = "Endring siste 7 dager:";
        document.getElementById("changeInfo3").innerHTML = "Endring siste 7 dager:";
        document.getElementById("changeInfo4").innerHTML = "Endring siste 7 dager:";
        document.getElementById("changeInfo5").innerHTML = "Endring siste 7 dager:";
        document.getElementById("changeInfo6").innerHTML = "Endring siste 7 dager:";

        // 3. hent relaterte kontoer til FB profil
        const fbAccInfo = await getMyfbAccPage(
          responseItem.userIdInfo,
          responseItem.accessTokenInfo
        );
        // Returnerer FB side-info
        const facebookAccName = fbAccInfo.data[0].name;
        const faceAccFollowers = fbAccInfo.data[0].engagement.count;
        
        // Test av Page Data
        console.log("Your page info: " + facebookAccName);
        document.getElementById("followers").innerHTML = faceAccFollowers;

        // Kode for gjenbruk
        const fbPageAccId = fbAccInfo.data[0].id;
        const fbPageAccesstoken = fbAccInfo.data[0].access_token;

        // 4. hent sidens Facebook Innsikt
        const fbPageInsights = await getMyfbPageInsights(
          fbPageAccId,
          fbPageAccesstoken
        );

        // Returner innsiktsdata om sidevisninger
        const facePageViews = fbPageInsights.data[0].values[6].value;
        document.getElementById("pageStats").innerHTML = facePageViews;
        const weeklyFBPageViews = fbPageInsights.data[0].values[0].value;

        // Funksjon for prosentendring
        function getPercentageChange(newNumber, oldNumber){
          let difference = newNumber - oldNumber;
            return parseInt(Math.abs(difference / oldNumber) * 100);
        }
        document.getElementById("pageStatsWeek").innerHTML = getPercentageChange(facePageViews, weeklyFBPageViews) + "%";
        changeColor(weeklyFBPageViews, facePageViews);

        // funksjon for riktig språk 
        function returnLanguage (number) {
          if (number === 1) {
            document.getElementById("newFaceFollowers").innerHTML = number + " ny denne uka";
          } else {
            document.getElementById("newFaceFollowers").innerHTML = number + " nye denne uka";
          }
        }

        // Hente data om likes
        const fbPageLikes = fbPageInsights.data[2].values[6].value;
        document.getElementById("pageLikes").innerHTML = fbPageLikes;
        const weeklyfbLikes = fbPageInsights.data[2].values[0].value;
        document.getElementById("weeklyPageLikes").innerHTML = getPercentageChange(fbPageLikes, weeklyfbLikes) + "%";

        // Bytt farge og ikon på forrige ukes sammenligningsdata
        let styleCard2 = document.getElementById("changeColor2");
        let img4 = document.getElementById("myImg4");
          if (weeklyfbLikes > fbPageLikes) {
            styleCard2.style.color = "hsl(356, 69%, 56%)";
            img4.src = "images/icon-down.svg";
          } else if (weeklyfbLikes == fbPageLikes) {
            styleCard2.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard2.style.color = "hsl(163, 72%, 41%)";
            img4.src = "images/icon-up.svg";
          }
        
        // hent engasjement-data
        const fbEngagement = fbPageInsights.data[1].values[6].value;
        document.getElementById("pageEngagement").innerHTML = fbEngagement;
        const weeklyFbEngagement = fbPageInsights.data[1].values[0].value;
        document.getElementById("weeklyPageEngagement").innerHTML = getPercentageChange(fbEngagement, weeklyFbEngagement) + "%";

        // Bytt farge og ikon på forrige ukes sammenligningsdata
        let styleCard5 = document.getElementById("changeColor5");
        let img7 = document.getElementById("myImg7");
          if (weeklyFbEngagement > fbEngagement) {
            styleCard5.style.color = "hsl(356, 69%, 56%)";
            img7.src = "images/icon-down.svg";
          } else if (weeklyFbEngagement == fbEngagement) {
            styleCard5.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard5.style.color = "hsl(163, 72%, 41%)";
            img7.src = "images/icon-up.svg";
          }

        // hent fb rekkevidde data
        const fbReach = fbPageInsights.data[3].values[6].value;
        document.getElementById("fbReach").innerHTML = fbReach;
        const weeklyFbReach = fbPageInsights.data[3].values[0].value;
        document.getElementById("weeklyFbReach").innerHTML = getPercentageChange(fbReach, weeklyFbReach) + "%";

        // Bytt farge og ikon på forrige ukes sammenligningsdata
        let styleCard6 = document.getElementById("changeColor6");
        let img8 = document.getElementById("myImg8");
          if (weeklyFbReach > fbReach) {
            styleCard6.style.color = "hsl(356, 69%, 56%)";
            img8.src = "images/icon-down.svg";
          } else if (weeklyFbReach == fbReach) {
            styleCard6.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard6.style.color = "hsl(163, 72%, 41%)";
            img8.src = "images/icon-up.svg";
          }

        // nye følgere - endring
        const newFaceFollowers = fbPageInsights.data[4].values[6].value;
        returnLanguage(newFaceFollowers);
        changeHeader(newFaceFollowers);

        // 5. hent relatert instagram profil 
        const fbInstaInfo = await getMyFbInstaBusinessAcc(
          fbPageAccId,
          fbPageAccesstoken
        );

        // hent instagram info
        const instaProfileInfo = await getMyInstagramAccInfo(
          fbInstaInfo.instagram_business_account.id,
          fbPageAccesstoken
          );

        // returner instagram data
        const instaPageName = instaProfileInfo.name;
        const instaFollowersCount = instaProfileInfo.followers_count;
        console.log("Your Instagram Page Name: " + instaPageName);
        document.getElementById("instaFollowers").innerHTML = instaFollowersCount;

        // Legg sammen antall følgere i sosiale medier
        const totalFollowers = (instaFollowersCount, faceAccFollowers) => instaFollowersCount + faceAccFollowers; 
        document.getElementById("totalFollowers").innerHTML = "Totalt Antall Følgere: " + (totalFollowers(instaFollowersCount,faceAccFollowers));

        // 6. hent instagram insikten
        const instaProfileInsight = await getMyInstagramAccInsight(
          fbInstaInfo.instagram_business_account.id,
          fbPageAccesstoken
        );
        // Returner innsiktsdata
        const instaPageViews = instaProfileInsight.data[0].values[6].value; 
        document.getElementById("instaPageViews").innerHTML = instaPageViews;

        const weeklyInstaViews = instaProfileInsight.data[0].values[0].value;
        document.getElementById("instaPageViewsWeek").innerHTML = 
        getPercentageChange(instaPageViews, weeklyInstaViews) + "%";
        // Bytt farge og ikon på forrige ukes sammenligningsdata
        let styleCard3 = document.getElementById("changeColor3");
        let img5 = document.getElementById("myImg5");
          if (weeklyInstaViews > instaPageViews) {
            styleCard3.style.color = "hsl(356, 69%, 56%)";
            img5.src = "images/icon-down.svg";
          } else if (weeklyInstaViews == instaPageViews) {
            styleCard3.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard3.style.color = "hsl(163, 72%, 41%)";
            img4.src = "images/icon-up.svg";
          }; 

        const instaPageReach = instaProfileInsight.data[1].values[6].value;
        document.getElementById("instaPageReach").innerHTML = instaPageReach;
        const instaWeekReach = instaProfileInsight.data[1].values[0].value;
        document.getElementById("instaPageReachWeek").innerHTML = getPercentageChange(instaPageReach, instaWeekReach) + "%";

        // Bytt farge og ikon på forrige ukes sammenligningsdata
        let styleCard4 = document.getElementById("changeColor4");
        let img6 = document.getElementById("myImg6");
          if (instaWeekReach > instaPageReach) {
            styleCard4.style.color = "hsl(356, 69%, 56%)";
            img6.src = "images/icon-down.svg";
          } else if (instaWeekReach == instaPageReach) {
            styleCard4.style.color = "hsl(228, 34%, 66%)";
          } else {
            styleCard4.style.color = "hsl(163, 72%, 41%)";
            img6.src = "images/icon-up.svg";
          } 

        // henter nye insta-følgere
        const newInstaFollowers = await getInstaFollowers(
          fbInstaInfo.instagram_business_account.id,
          fbPageAccesstoken
        );

        // sammenlign insta følgere
        const oldInstaFollowers = newInstaFollowers.data[0].values.map(value => value.value);
        const instaFollowTotal = oldInstaFollowers.reduce(sum, 0);
          function sum(accumulator, value) {
            return accumulator + value;
          }
        // Prøve if statement for riktig språk?
        if (instaFollowTotal === 1) {
          document.getElementById("oldInstaFollowers").innerHTML = instaFollowTotal + " ny denne uka";
        } else {
          document.getElementById("oldInstaFollowers").innerHTML = instaFollowTotal + " nye denne uka";
        }
        
        if (instaFollowTotal > 0) {
          document.getElementById("instaColor").style.color = "hsl(163, 72%, 41%)";
            document.getElementById("myImg2").src = "images/icon-up.svg";
          } else {
            instaColor.style.color = "hsl(228, 34%, 66%)";
          } 
    };

    const loginFailFunc = async (responseItem) => {};
      window.flowFacebookData = {
        appId: appId,
        clientToken: clientToken,
        loginSuccessFunc: loginSuccessFunc,
        loginFailFunc: loginFailFunc,
      };
      initializeFlow();
      window.handlefbLogin = doLogin;
      // <-----initialize data
  </script>    
      
      <div class="attribution">Laget for Stasjonsdrift Mangla AS av Sebastian Ephithite, Henrik Hornnæss og Morten Røstad</div>
<script src="./js/script.js"></script>
</body>
</html>